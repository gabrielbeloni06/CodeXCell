<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>CodeXCell - Resultados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/result.css') }}">
</head>
<body>
    <header>
        <h1>CodeXCell</h1>
        <nav>
            <a href="{{ url_for('home') }}">Home</a> |
            <a href="{{ url_for('analyze') }}">Analisar</a>
        </nav>
    </header>

    <main>
        <h2>Resultados da Análise</h2>

        <p><strong>Sequência:</strong> {{ sequence }}</p>

        <h3>Contagem de Bases</h3>
        <ul>
            <li>A: {{ counts.A }}</li>
            <li>T: {{ counts.T }}</li>
            <li>C: {{ counts.C }}</li>
            <li>G: {{ counts.G }}</li>
        </ul>

        <p><strong>GC Content:</strong> {{ gc_content }}%</p>

        {% if start_codon %}
        <p><strong>Start codon encontrado na posição:</strong> {{ start_codon }}</p>
        {% else %}
        <p><strong>Nenhum start codon encontrado.</strong></p>
        {% endif %}

        <div class="chart">
            <h3>Gráfico de Frequência</h3>
            <img src="{{ url_for('plot_png', seq=sequence) }}" alt="Gráfico de nucleotídeos">
        </div>

        <div class="orfs">
            <h3>ORFs Detectados</h3>
            {% if orfs and orfs|length > 0 %}
                <table border="1" cellpadding="5">
                    <tr>
                        <th>Frame</th>
                        <th>Início</th>
                        <th>Fim</th>
                        <th>Tamanho (nt)</th>
                        <th>Proteína</th>
                    </tr>
                    {% for orf in orfs %}
                    <tr>
                        <td>{{ orf.frame }}</td>
                        <td>{{ orf.start }}</td>
                        <td>{{ orf.end }}</td>
                        <td>{{ orf.length }}</td>
                        <td>{{ orf.protein }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>Nenhum ORF encontrado.</p>
            {% endif %}
        </div>

        <div class="repeats">
            <h3>Motivos Repetitivos Detectados</h3>
            {% if repeats and repeats|length > 0 %}
                <table border="1" cellpadding="5">
                    <tr>
                        <th>Motivo</th>
                        <th>Início</th>
                        <th>Fim</th>
                        <th>Número de repetições</th>
                    </tr>
                    {% for rep in repeats %}
                    <tr>
                        <td>{{ rep.motif }}</td>
                        <td>{{ rep.start }}</td>
                        <td>{{ rep.end }}</td>
                        <td>{{ rep.repeats }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>Nenhum motivo repetitivo encontrado.</p>
            {% endif %}
        </div>

        <div class="comparison">
            <h3>Comparação de Sequências</h3>
            {% if comparison %}
                <pre>
        Seq1: {{ comparison.seq1 }}
            {{ comparison.alignment }}
        Seq2: {{ comparison.seq2 }}
                </pre>
                <p><strong>Identidade:</strong> {{ comparison.identity }}%</p>
            {% else %}
                <p>Nenhuma segunda sequência fornecida.</p>
            {% endif %}
        </div>

        <div class="gc-windows">
            <h3>GC Content por janela</h3>
            {% if gc_windows and gc_windows|length > 0 %}
                <table border="1" cellpadding="5">
                    <tr>
                        <th>Início</th>
                        <th>Fim</th>
                        <th>GC (%)</th>
                    </tr>
                    {% for w in gc_windows %}
                    <tr>
                        <td>{{ w.start }}</td>
                        <td>{{ w.end }}</td>
                        <td>{{ w.gc }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>Sequência muito curta para análise em janelas.</p>
            {% endif %}
        </div>
        <div class="codons">
            <h3>Frequência de Códons (Top 10)</h3>
            {% if codons and codons|length > 0 %}
                <table border="1" cellpadding="5">
                    <tr>
                        <th>Códon</th>
                        <th>Contagem</th>
                    </tr>
                    {% for codon, count in codons %}
                    <tr>
                        <td>{{ codon }}</td>
                        <td>{{ count }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>Nenhum códon encontrado.</p>
            {% endif %}
        </div>

        <div class="aminoacids">
            <h3>Análise de Aminoácidos</h3>
            {% for orf in orfs %}
                <p><strong>Proteína do ORF (frame {{ orf.frame }}):</strong> {{ orf.protein }}</p>
                <p>Tamanho: {{ orf.analysis.length }} aa | Peso molecular: {{ orf.analysis.weight }} Da</p>
                <p>Frequência relativa:</p>
                <ul>
                    {% for aa, perc in orf.analysis.freq.items() %}
                        <li>{{ aa }}: {{ perc }}%</li>
                    {% endfor %}
                </ul>
            {% endfor %}
        </div>
        <div class="motifs">
            <h3>Motivos Biológicos Detectados</h3>
            {% if motifs and motifs|length > 0 %}
                <table border="1" cellpadding="5">
                    <tr>
                        <th>Motivo</th>
                        <th>Sequência</th>
                        <th>Início</th>
                        <th>Fim</th>
                    </tr>
                    {% for m in motifs %}
                    <tr>
                        <td>{{ m.motif }}</td>
                        <td>{{ m.sequence }}</td>
                        <td>{{ m.start }}</td>
                        <td>{{ m.end }}</td>
                    </tr>
                    {% endfor %}
                </table>
            {% else %}
                <p>Nenhum motivo clássico encontrado.</p>
            {% endif %}
        </div>

        <div class="gc-heatmap">
            <h3>Heatmap de GC Content</h3>
            {% if gc_windows and gc_windows|length > 0 %}
                <div style="display:flex;">
                    {% for w in gc_windows %}
                        {% set color = 'rgb(' ~ (255 - (w.gc*2.55)|int) ~ ',' ~ (255 - (w.gc*1.5)|int) ~ ',' ~ (w.gc*2.55)|int ~ ')' %}
                        <div title="Pos {{ w.start }}-{{ w.end }}: {{ w.gc }}%" 
                            style="width:20px; height:20px;">
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p>Sequência muito curta para heatmap.</p>
            {% endif %}
        </div>

        <div class="orf-visual">
        <h3>Visualização gráfica dos ORFs (Canvas)</h3>
        <canvas id="orfCanvas" width="800" height="80" style="border:1px solid #ccc;"></canvas>
        <p style="font-size: 0.9em; color: #555;">
            Cada cor representa um frame diferente (1 = verde, 2 = azul, 3 = laranja).
        </p>
        </div>
        <div id="orfData"
            data-orfs='{{ orfs|tojson|safe }}'
            data-length='{{ sequence|length }}'></div>
        <script src="{{ url_for('static', filename='js/orf.js') }}"></script>


        <div class="codon-bias">
        <h3>Codon Bias (comparação com organismo de referência)</h3>
        {% if bias and bias|length > 0 %}
            <table border="1" cellpadding="5">
            <tr>
                <th>Códon</th>
                <th>Freq. na sequência</th>
                <th>Freq. no organismo</th>
                <th>Razão (seq/ref)</th>
            </tr>
            {% for b in bias %}
            <tr>
                <td>{{ b.codon }}</td>
                <td>{{ b.freq_seq }}</td>
                <td>{{ b.freq_ref }}</td>
                <td>{{ b.ratio }}</td>
            </tr>
            {% endfor %}
            </table>
        {% else %}
            <p>Não foi possível calcular o Codon Bias (API indisponível).</p>
        {% endif %}
        </div>





        <div class="explanation">
            <h3>Explicação</h3>
            <p>[Texto gerado pelo LLM será exibido aqui]</p>
        </div>
    </main>

    <footer>
        <p>Projeto CodeXCell © 2025</p>
    </footer>
</body>
</html>
